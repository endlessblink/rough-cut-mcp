# ü¶æ ROUGHCUT MCP - END-TO-END WINDOWS EXECUTION GUIDE

## üåç UNIVERSAL COMPATIBILITY RULE #1 üåç
```
üö® EVERYTHING MUST BE UNIVERSALLY COMPATIBLE üö®

‚ùå NEVER hardcode specific user names, project names, or system paths
‚ùå NEVER assume specific installations, operating systems, or environments  
‚ùå NEVER create code that only works on one person's setup
‚ùå NEVER use absolute paths, user-specific directories, or local-only resources

‚úÖ ALWAYS use dynamic, pattern-based matching for ANY project name
‚úÖ ALWAYS use web-safe fonts, colors, and CSS that work everywhere
‚úÖ ALWAYS create code that works on ANY Windows installation
‚úÖ ALWAYS use relative paths and universal configurations
‚úÖ ALWAYS test with generic project names and standard setups

THE MCP MUST WORK FOR EVERYONE, NOT JUST THE ORIGINAL DEVELOPER
```

## üö® CRITICAL RULE: NEVER RESTRICT WITH TEMPLATES! üö®
```
‚ùå NEVER ADD HARDCODED TEMPLATES THAT LIMIT FLEXIBILITY:
- Hardcoded animation patterns like "bounce ball template", "logo reveal template" 
- User limited to only those specific types
- If you want something new, you're stuck
- This IS restrictive and defeats the purpose

‚ùå NEVER ADD COMPLEX AUTOMATIC GENERATION TOOLS:
- Generate animations automatically using templates
- Add complexity and potential breaking changes  
- Over-engineer what already works

‚úÖ ALWAYS ENHANCE CLAUDE DESKTOP'S NATURAL GENERATION:
- Provide design guidelines and system prompts
- Teach better animation principles through documentation
- Keep the simple create-video and edit-video-jsx workflow
- Maintain unlimited flexibility while improving quality

THE SYSTEM MUST REMAIN INFINITELY FLEXIBLE - ANY ANIMATION TYPE, ANY CREATIVE IDEA
```

## üö® CRITICAL MCP RULE: ALWAYS FIX THE MCP, NOT SPECIFIC ANIMATIONS! üö®
```
‚ùå NEVER fix VideoComposition.tsx files to solve GENERATION ERRORS from the MCP!
‚ùå NEVER patch individual projects when the MCP is creating invalid code!
‚ùå NEVER band-aid animation files when the root cause is in the MCP system!
‚úÖ ALWAYS fix the MCP generation system in src/services/ and src/tools/
‚úÖ Fix the root cause in animation-generator.ts or creation-tools.ts
‚úÖ Ensure ALL future animations work, not just one specific case
```

**‚ö†Ô∏è CLARIFICATION: When TO edit VideoComposition.tsx:**
- ‚úÖ **User requests specific edits** to their animation content
- ‚úÖ **Composition tool usage** - editing elements via the MCP tool
- ‚úÖ **User customization** - changing colors, text, timing per user request

**‚ùå When NOT to edit VideoComposition.tsx:**
- ‚ùå **Fixing MCP generation bugs** like interpolation errors, syntax errors
- ‚ùå **Correcting invalid code** that the MCP generated incorrectly
- ‚ùå **Patching system-level issues** that affect multiple projects

### ‚ö° WHY THIS IS CRITICAL:
- **Fixes the system**: Updates benefit ALL future animations
- **Prevents recurring issues**: Root cause elimination vs symptom treatment  
- **Scalable solution**: One fix solves the problem universally
- **Professional approach**: Infrastructure fixes, not band-aids

### üõ†Ô∏è WHERE TO FIX MCP ISSUES:
- `src/services/animation-generator.ts` - AI animation generation
- `src/tools/creation-tools.ts` - Video creation templates  
- `src/utils/interpolation-validator.ts` - Validation logic
- `src/tools/composition-editor.ts` - Element editing logic

**ALWAYS ask: "How can I fix this in the MCP so it never happens again?"**

---

## üîç CRITICAL RULE: RESEARCH FIRST, DON'T GUESS! üîç

### ‚ö° LESSON LEARNED - ALWAYS RESEARCH BEFORE IMPLEMENTING:
- ‚úÖ **Research official Remotion docs** for correct project structure  
- ‚úÖ **Proper src/index.ts** with `registerRoot(Root)` (required entrypoint)
- ‚úÖ **Complete dependencies** including React types and TypeScript
- ‚úÖ **tsconfig.json** for proper TypeScript support
- ‚úÖ **6600-6620 port range** (configured range, not default 3000s)

### üö® WHY THIS IS CRITICAL:
- **Assumptions create broken systems**: Guessing leads to complex fixes for wrong problems
- **Research prevents complexity hell**: Understanding requirements prevents over-engineering  
- **Official docs are truth**: Framework expectations must be met exactly
- **Structure errors cascade**: Wrong project structure breaks everything downstream

### üõ°Ô∏è BEFORE ANY MAJOR CHANGE:
1. **Research official documentation** for the target system
2. **Understand the expected patterns** and requirements
3. **Test minimal examples** before building complex solutions
4. **Verify assumptions** with authoritative sources

**NEVER assume - always verify with official sources first!**

---

## üî¥ CRITICAL RULE #1: NEVER HARDCODE PROJECT NAMES! üî¥
```
‚ùå NEVER EVER HARDCODE SPECIFIC PROJECT NAMES OR USERS IN THE CODE!
‚ùå Do NOT add specific project names like "endlessblink-matrix", "matrix", "john-video"
‚ùå Do NOT hardcode user names or specific use cases
‚ùå This makes the MCP unusable for everyone else!
```

### ‚ö° WHY THIS DESTROYS THE MCP:
- **Breaks universality**: Only works for the hardcoded names
- **Makes distribution impossible**: Other users can't use it
- **Violates MCP principles**: Should be generic and reusable
- **Creates maintenance nightmare**: Need to update code for every user

### ‚úÖ DO THIS INSTEAD:
```typescript
// ‚úÖ GOOD: Generic pattern matching
const variations = [
  name.toLowerCase(),
  name.replace(/[-_]/g, ''),  // Remove separators
  name.replace(/[-_]/g, ' '), // Replace with spaces
  ...name.split(/[-_]/)       // Split into words
];

// ‚ùå BAD: Hardcoded names
const variations = ['endlessblink-matrix', 'matrix', 'john-project'];
```

**ALWAYS use dynamic, pattern-based matching that works for ANY project name!**

---

## üî¥ CRITICAL: THE #1 RULE TO REMEMBER üî¥
```
WSL PATHS (/mnt/d/...) SHOULD NEVER EXIST IN THE FIRST PLACE!
- Build on Windows ‚Üí Get Windows paths
- Run on Windows ‚Üí Use Windows paths  
- NEVER build in WSL2 ‚Üí NEVER get WSL paths!
```

---

## üö® STRICT REQUIREMENT: WINDOWS-ONLY EXECUTION (E2E) üö®

### ‚ö†Ô∏è THE GOLDEN RULE: NO WSL PATHS SHOULD EVER EXIST ‚ö†Ô∏è
**If you see `/mnt/d/...` paths ANYWHERE, you're doing it wrong!**

### DO NOT RUN ANY MCP OR REMOTION WORKLOADS IN WSL2

- ‚úÖ **Windows Native Execution Only**: All MCP, Remotion Studio, and associated tools must be run exclusively through Windows executables and Windows paths.
- ‚úÖ **Project Development May Occur in WSL2**: You may **edit, git, and manage** files using WSL2 or VS Code WSL integration, but all build, serve, and tool launch must be done on Windows.
- ‚úÖ **Project and Asset Locations Must Be Windows Paths**: E.g. `D:\MY PROJECTS\AI\LLM\AI Code Gen\my-builds\Video + Motion\RoughCut`
- ‚ùå **NO Operations in WSL2 Paths**: Never use `/mnt/d/...` or any Linux-only or pseudo-Linux path for execution. MCP, Remotion CLI, and Node.js scripts must never reference or launch in WSL2 paths.
- ‚ùå **NO Linux-Only Node.js, npm, or Remotion**: Do not install or run Node.js or dependencies inside a WSL2 Linux environment for anything production related.

**WHY:**  
- **Building in WSL2 creates WSL paths** that Windows cannot execute
- **WSL paths (`/mnt/d/...`) should NEVER exist** in the compiled code
- **All paths must be Windows native (`D:\...`) from the start**
- Mixing execution environments causes "Process exited with code 1" failures

---

## ‚ú≥Ô∏è DEV/PROD FLOW

| Step                   | Where                  | How                                     | Path Style                |
|------------------------|------------------------|------------------------------------------|---------------------------|
| 1. **Edit code**       | WSL2 (optional)        | Via VS Code WSL, shell, or git           | `/mnt/d/...`              |
| 2. **Build/Run**       | **Windows native**     | Always run build, serve, and CLI tools   | `D:\MY PROJECTS\...`      |
| 3. **CLI Tools**       | **Windows native**     | Spawn, npm, npx from Windows Node.js     | `D:\MY PROJECTS\...`      |
| 4. **Asset paths**     | **Windows naming**     | Only Windows paths in configs and tools  | `D:\MY PROJECTS\...`      |

**Note:**  
All execution, launches, spawns, builds, and MCP JSON output must use Windows-native paths and environments.

---

## üèóÔ∏è PROJECT STRUCTURE (WINDOWS PATHS ONLY)

```
D:\MY PROJECTS\AI\LLM\AI Code Gen\my-builds\Video + Motion\RoughCut\
‚îú‚îÄ‚îÄ build\index.js                    # Compiled MCP server (run only in Windows)
‚îú‚îÄ‚îÄ src\                             # Source code (edit in WSL2 OK)
‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ tools\
‚îÇ   ‚îú‚îÄ‚îÄ services\
‚îÇ   ‚îú‚îÄ‚îÄ utils\
‚îÇ   ‚îî‚îÄ‚îÄ types\
‚îú‚îÄ‚îÄ assets\
‚îÇ   ‚îî‚îÄ‚îÄ projects\                   # All Remotion projects (Windows path)
‚îÇ   ‚îî‚îÄ‚îÄ videos\
‚îÇ   ‚îî‚îÄ‚îÄ cache\
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ CLAUDE.md   # (this file)
```

---

## üõë WINDOWS CONFIGURATION - MCP JSON-RPC STRICTNESS

- MCP runs as a **JSON-RPC over stdio** process from Windows Claude Desktop.
- ‚≠ê **Do not use any console.log, console.error, etc. in MCP!**
- ‚≠ê Use only file-based logging.
- **MCP config file must only use Windows paths:**

‚ö†Ô∏è **CRITICAL: Always use Windows Claude Desktop config path:**
**‚úÖ CORRECT**: `C:\Users\endle\AppData\Roaming\Claude\claude_desktop_config.json`
**‚ùå NEVER USE**: `/mnt/c/Users/endle/AppData/...` or `/home/endlessblink/AppData/...`

```json
{
  "mcpServers": {
    "rough-cut-mcp": {
      "command": "C:\\Program Files\\nodejs\\node.exe",
      "args": [
        "D:\\MY PROJECTS\\AI\\LLM\\AI Code Gen\\my-builds\\Video + Motion\\RoughCut\\build\\index.js"
      ],
      "env": {
        "NODE_ENV": "production",
        "REMOTION_ASSETS_DIR": "D:\\MY PROJECTS\\AI\\LLM\\AI Code Gen\\my-builds\\Video + Motion\\RoughCut\\assets"
      }
    }
  }
}
```

---

## üö® CRITICAL: MCP JSON-RPC PROTOCOL REQUIREMENTS üö®

**NEVER ADD CONSOLE OUTPUT TO MCP SERVER CODE!**
- ‚ùå **NO console.log()** - Breaks JSON-RPC communication
- ‚ùå **NO console.error()** - Causes "Unexpected token" JSON parse errors  
- ‚ùå **NO console.warn()** - Corrupts MCP protocol messages
- ‚ùå **NO console.debug()** - Interferes with Claude Desktop communication
- ‚ùå **NO console.time()/timeEnd()** - Outputs to stdout breaking protocol
- ‚úÖ **USE logger.info/debug/error** - Writes to files only, not stdout/stderr
- ‚úÖ **ALWAYS REBUILD** after removing console statements: `npm run build`

**WHY THIS MATTERS:**
- MCP uses JSON-RPC over stdio (stdin/stdout)
- ANY console output corrupts the JSON stream
- Results in errors like: "Unexpected token 'D', '[DEBUG] Rec'... is not valid JSON"
- This is a RECURRING issue that breaks Claude Desktop integration

---

## ‚ö° KEY EXECUTION RULES - BUILD AND RUN ON WINDOWS ONLY!

### üö® CRITICAL BUILD STEPS (WINDOWS ONLY):
1. **Open Windows PowerShell or CMD** (NOT WSL2 terminal!)
2. **Navigate to project in Windows:**
   ```powershell
   cd "D:\MY PROJECTS\AI\LLM\AI Code Gen\my-builds\Video + Motion\RoughCut"
   ```
3. **Install dependencies with Windows npm:**
   ```powershell
   npm install
   ```
4. **Build with Windows Node.js:**
   ```powershell
   npm run build
   ```

### WHY THIS IS CRITICAL:
- **Building in WSL2 bakes WSL paths into the code** (`/mnt/d/...`)
- **Windows can't execute WSL paths** ‚Üí "Process exited with code 1"
- **All paths must be Windows native from the start** (`D:\...`)

### NEVER DO THIS:
```bash
# ‚ùå WRONG - WSL2 terminal
cd /mnt/d/MY\ PROJECTS/...
npm run build  # This creates WSL paths!
```

### ALWAYS DO THIS:
```powershell
# ‚úÖ CORRECT - Windows PowerShell/CMD
cd "D:\MY PROJECTS\..."
npm run build  # This creates Windows paths!
```

- **Launch MCP ONLY via Windows:**  
  Either through Claude Desktop auto-discovery or manually with:
  ```
  "C:\Program Files\nodejs\node.exe" "D:\...\RoughCut\build\index.js"
  ```

- **Remotion Studio Launches:**  
  Must be from Windows, with `cwd` and config paths as Windows native.  
  No `/mnt/...` or Linux home dir references allowed.

---

## üßë‚Äçüíª DEVELOPMENT FLOW (FOR DEVELOPERS)

### ‚ö†Ô∏è REMEMBER: WSL PATHS SHOULD NEVER EXIST IN THE FIRST PLACE! ‚ö†Ô∏è

1. **You MAY edit source files in WSL2 or with any IDE.**
2. **NEVER build using `npm run build` in WSL2** - This bakes WSL paths into the code!
3. **NEVER run using `node` or `npx` in WSL2** - This uses WSL paths!
4. **When ready to test:**
    - **MUST** switch to Windows PowerShell/CMD
    - **MUST** navigate using Windows path: `cd "D:\MY PROJECTS\..."`
    - **MUST** build with Windows npm: `npm run build`
    - **MUST** run all commands from Windows terminal
5. **All paths everywhere must be Windows paths** - Never `/mnt/d/...`!

---

## ‚úÖ EXAMPLES OF ACCEPTABLE vs. UNACCEPTABLE USAGE

| Acceptable (‚úî)                    | Not Acceptable (‚úó)                |
|------------------------------------|-----------------------------------|
| `"D:\MY PROJECTS\foo\bar.js"`      | `"/mnt/d/MY PROJECTS/foo/bar.js"` |
| `C:\Program Files\nodejs\node.exe` | `node` (if Linux node in WSL2)    |
| Run in Windows terminal/cmd/pwsh   | Run in WSL2 shell                 |
| Windows-based npm, Remotion, etc.  | Linux npm/node/Remotion           |
| Build in Windows, edit in WSL2     | Build in WSL2                     |
| Asset/project paths use `\`        | Asset project paths use `/`       |

---

## üóÇÔ∏è WHY THIS MATTERS

- **Reliability:** Prevents exec/spawn failures, inaccessible paths, and cross-platform bugs.
- **Performance:** Windows Node.js is optimized for NTFS and Windows processes on Windows drives.
- **Claude Desktop Integration:** Desktop MCP can ONLY access Windows paths, not Linux, and expects MCP tools to do the same.

---

## üéØ LAYERED TOOL ARCHITECTURE (Implemented Jan 26, 2025)

### Overview
The MCP server now implements a **layered tool architecture** that dramatically improves performance by reducing initial tool exposure from 43 tools to just 9 tools. This addresses LLM performance degradation that occurs when too many tools are presented at once.

### Why This Was Implemented
- **Research shows** LLMs get confused with 40+ tools
- **Reduces context bloat** by 79% (from ~8,600 to ~1,800 tokens)
- **Improves tool selection accuracy** through better organization
- **Enables scalability** for future tool additions

### Tool Organization Structure

#### Layer 1: Discovery Tools (Always Active - 6 tools)
- `discover-capabilities` - Show available tool categories
- `activate-toolset` - Load specific tool categories
- `search-tools` - Find tools by name/functionality
- `get-active-tools` - List currently loaded tools
- `suggest-tools` - Get intelligent recommendations
- `get-tool-usage-stats` - View usage analytics

#### Layer 2: Core Operations (Default Loaded - 3 tools)
- `list-video-projects` - List all animation projects
- `get-project-status` - Get project information
- `launch-project-studio` - Launch Remotion Studio

#### Layer 3: On-Demand Categories (30+ tools total)
- **Video Creation** (9 tools) - Animation creation/editing
- **Studio Management** (11 tools) - Remotion Studio control
- **Voice Generation** (5 tools) - ElevenLabs TTS (requires API key)
- **Sound Effects** (5 tools) - Freesound integration (requires API key)
- **Image Generation** (6 tools) - Flux AI images (requires API key)
- **Maintenance** (4 tools) - Asset cleanup/organization

### How to Use

#### Discovering Available Tools
```
1. Use `discover-capabilities` to see all categories
2. Use `get-active-tools` to see currently loaded tools
3. Use `search-tools` with a query to find specific tools
```

#### Activating Tool Categories
```
Use `activate-toolset` with:
- categories: ["video-creation", "studio-management"]
- exclusive: true/false (whether to deactivate others first)
```

#### Example Workflow
```
1. Start ‚Üí 9 tools available (6 discovery + 3 core)
2. Need to create video ‚Üí activate-toolset { categories: ["video-creation"] }
3. Need voice ‚Üí activate-toolset { categories: ["voice-generation"] }
4. Tools are now available for use
```

### Configuration Options

#### Default Mode (Layered - Recommended)
- Starts with only 9 tools
- Load additional tools on demand
- Better performance and accuracy

#### Legacy Mode (All Tools)
Set environment variable to load all 43 tools at once:
```powershell
$env:MCP_LEGACY_MODE = "true"
```

### Performance Improvements
| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| Initial Tools | 43 | 9 | 79% reduction |
| Context Tokens | ~8,600 | ~1,800 | 79% reduction |
| Tool Organization | None | 9 categories | Better structure |
| Dynamic Loading | No | Yes | On-demand |

### Key Implementation Files
- `src/services/tool-registry.ts` - Dynamic tool management system
- `src/tools/discovery-tools.ts` - Discovery layer implementation
- `src/types/tool-categories.ts` - Tool category definitions
- `src/index.ts` - Updated to use tool registry
- `LAYERED-TOOLS-GUIDE.md` - Detailed documentation
- `test-layered-tools.js` - Test script for verification

### Testing the Architecture
```powershell
# Build on Windows
.\build-windows.ps1

# Test the layered system
node test-layered-tools.js
```

---

## üõ†Ô∏è COMPLETE MCP TOOLS REFERENCE

### ‚úÖ Project Management Tools (WORKING)
- **`list-video-projects`** - Lists all video projects in assets/projects
- **`get-project-status`** - Gets detailed information about projects
- **`analyze-video-structure`** - Analyzes VideoComposition.tsx structure
- **`launch-project-studio`** - Launches Remotion Studio for specific project
- **`edit-video-element`** - Edits video elements (needs AST implementation)
- **`install-project-dependencies`** - Installs npm dependencies for a project
- **`repair-project`** - Repairs broken projects by adding missing files

### ‚úÖ Video Creation Tools
- **`create-complete-video`** - Creates new video with React component code
- **`create-text-video`** - Creates simple text-only video
- **`generate-video-assets`** - Generates voice/images/sounds for videos

### ‚úÖ Studio Management Tools (WORKING)
- **`launch-remotion-studio`** - Launches Remotion Studio dashboard
- **`stop-remotion-studio`** - Stops running Remotion Studio instance
- **`get-studio-status`** - Checks studio status and running instances
- **`launch-studio-with-project`** - Launches studio with specific project

### ‚úÖ Asset Management Tools
- **`get-asset-statistics`** - Gets comprehensive asset statistics
- **`cleanup-old-assets`** - Cleans up old temporary files
- **`organize-assets`** - Organizes asset directories
- **`get-disk-usage`** - Gets disk usage information

---

## üìù MAINTAINING THE E2E WINDOWS PROMISE

### üî¥ THE CORE PRINCIPLE: NO WSL PATHS SHOULD EVER EXIST! üî¥

- **Build on Windows** = Windows paths in compiled code
- **Run on Windows** = Windows paths at runtime
- **Never build in WSL2** = Never get WSL paths in the first place!

- MCP, Remotion Studio, and all processes must run natively on Windows.
- WSL2 is for developer convenience only, *never* for launching/serving/building/CLI.
- All logs, outputs, scripts, and references must be Windows-native.
- Any breakage in this pattern will result in launch, spawn, or process failure (exit code 1, path not found, or process not discovered).

**If you see `/mnt/d/...` ANYWHERE in logs, output, or errors - STOP! You're building/running from WSL2!**

---

> **Edit code where you want, but BUILD, LAUNCH, and RUN everything in Windows. Nothing leaves Windows. No `/mnt/`, no `/home/`, no bash/npx under WSL2. If it's an MCP server, tool, or Remotion process, it is Windows-only e2e.**

---

## üìù POWERSHELL SCRIPTING GUIDELINES FOR WINDOWS

When creating PowerShell scripts for this project, follow these rules to ensure compatibility:

### ‚úÖ DO:
1. **Use simple ASCII text** - Avoid Unicode characters in scripts
2. **Put `else` on a new line** after the closing brace:
   ```powershell
   if ($condition) {
       # code
   }
   else {
       # code
   }
   ```
3. **Use basic Write-Host** for output
4. **Test scripts in actual Windows PowerShell** before deploying
5. **Keep variable names simple** without special characters

### ‚ùå DON'T:
1. **Don't use emoji or Unicode** in comments or strings (causes parsing errors)
2. **Don't put `else` on same line as `}`** - This syntax fails:
   ```powershell
   } else {  # WRONG - causes "Unexpected token" error
   ```
3. **Don't write scripts in WSL2** - Different line endings can cause issues
4. **Don't use complex nested structures** without testing

### Example Working Script Structure:
```powershell
Write-Host "Starting..." -ForegroundColor Cyan

if ($LASTEXITCODE -eq 0) {
    Write-Host "Success" -ForegroundColor Green
}
else {
    Write-Host "Failed" -ForegroundColor Red
    exit 1
}
```

---

## üé¨ MCP WORKFLOW VALIDATION

Claude Desktop MUST support this exact flow:
```
1. Claude Desktop ‚Üí "List the animations we have" 
   ‚Üì (calls list-video-projects)
   MCP finds all projects in assets/projects (Windows paths)

2. Claude Desktop ‚Üí "Launch the GitHub animation"
   ‚Üì (calls launch-project-studio)
   Studio launches with Windows paths

3. Claude Desktop ‚Üí "Create a new bouncing ball animation"
   ‚Üì (calls create-complete-video)
   Creates project with all required files using Windows paths

4. Claude Desktop ‚Üí "Kill current studio and restart fresh"
   ‚Üì (calls stop-remotion-studio then launch-project-studio)
   Studio restarts with Windows paths
```

**ANY PATH ISSUES OR CROSS-SUBSYSTEM EXECUTION WILL CAUSE FAILURES**

---

**THE MCP IS OPERATIONAL WITH WINDOWS-ONLY EXECUTION!**

---

## üö® CRITICAL ARCHITECTURE RULE: CLAUDE + MCP COLLABORATION (Aug 2025)

### üî¥ NEVER BREAK THIS ARCHITECTURE AGAIN! üî¥

**CORRECT ARCHITECTURE:**
```
Claude Desktop (AI) ‚Üí Generates unlimited animation JSX code
         ‚Üì
MCP (Transformer) ‚Üí Transforms JSX into working Remotion projects  
         ‚Üì
Remotion Studio ‚Üí Visual editing and rendering
```

**WRONG ARCHITECTURE (CAUSES "undefined component" ERRORS):**
```
MCP tries to generate animations itself ‚Üí Limited hardcoded patterns ‚Üí Fails for unknown types ‚Üí Empty VideoComposition.tsx ‚Üí Undefined component error
```

### üõ°Ô∏è **PREVENTION SAFEGUARDS IMPLEMENTED:**

1. **Triple-Layer Protection** in animation-generator.ts:
   - Layer 1: Hardcoded patterns (for known types)
   - Layer 2: Intelligent generation system (for unknown types)  
   - Layer 3: Minimal working animation (if all else fails)

2. **Export Standardization** in creation-tools.ts:
   - `standardizeJSXExports()` function fixes any export/import mismatches
   - Converts any React component to proper `VideoComposition` export
   - Prevents import failures in Root.tsx

3. **"ai-generated" Type** as default:
   - Claude Desktop generates complete JSX code
   - MCP just transforms it into proper project structure
   - Unlimited flexibility without hardcoded limitations

### üö® **DO NOT:**
- ‚ùå Disconnect intelligent generation system from animation-generator.ts
- ‚ùå Return empty strings from any animation generation function
- ‚ùå Make MCP try to "be intelligent" - Claude Desktop is the AI
- ‚ùå Remove export standardization safeguards
- ‚ùå Break the transformation architecture

### ‚úÖ **DO:**
- ‚úÖ Keep MCP as a transformation service (JSX ‚Üí Remotion project)
- ‚úÖ Let Claude Desktop handle all AI generation
- ‚úÖ Maintain multiple fallback layers
- ‚úÖ Always generate working JSX (never empty files)

**If you see "undefined component" errors, check that export standardization and fallback layers are still connected!**

---

## üéØ RECENT REFACTORING (Jan 2025) - WHAT'S NEW

### üì¶ New Architecture Overview
The project has been **completely refactored** to eliminate WSL path issues and improve maintainability:

#### Before Refactoring:
- ‚ùå **17+ scattered test files** in root directory
- ‚ùå **28 scripts** with hardcoded WSL paths causing failures
- ‚ùå **No centralized configuration** - paths scattered everywhere
- ‚ùå **Difficult to maintain** - duplicated logic across files
- ‚ùå **WSL path contamination** - `/mnt/d/...` paths breaking Windows execution

#### After Refactoring:
- ‚úÖ **1 unified test runner** - All tests in one command
- ‚úÖ **Centralized path management** - Single source of truth
- ‚úÖ **Clean architecture** - Organized directory structure
- ‚úÖ **Zero hardcoded paths** - All dynamically resolved
- ‚úÖ **100% Windows compatible** - Guaranteed to work on any Windows machine

### üÜï New Core Files

#### Path Management (`src/config/paths.ts`)
```typescript
// Centralized path management - handles WSL ‚Üî Windows conversion
import { paths } from './config/paths.js';
const buildPath = paths.getWindowsPath('build/index.js');
```

#### Unified Testing (`test/test-runner.cjs`)
```bash
npm test                    # Run all tests
npm run test:verify        # Verify installation only
```

#### Cross-Platform Build (`scripts/build.cjs`)
```bash
npm run build:cross-platform   # Intelligent build with validation
# - Detects WSL and prevents WSL paths
# - Validates build output
# - Ensures Windows compatibility
```

### üìÅ New Directory Structure
```
RoughCut/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ paths.ts           # üÜï Centralized path management
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ config.ts          # üîÑ Updated to use paths.ts
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ build.cjs              # üÜï Cross-platform build script
‚îÇ   ‚îî‚îÄ‚îÄ setup/
‚îÇ       ‚îú‚îÄ‚îÄ path-utils.cjs     # üÜï Script path utilities
‚îÇ       ‚îî‚îÄ‚îÄ verify-installation.cjs # üÜï Clean verification
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ test-runner.cjs        # üÜï Unified test runner
‚îÇ   ‚îú‚îÄ‚îÄ unit/                  # Unit tests
‚îÇ   ‚îú‚îÄ‚îÄ integration/           # Integration tests
‚îÇ   ‚îî‚îÄ‚îÄ e2e/                   # End-to-end tests
‚îî‚îÄ‚îÄ ARCHITECTURE.md            # üÜï Complete architecture guide
```

### üîß New Commands

| Old Command | New Command | Purpose |
|-------------|-------------|---------|
| `node test-layered-tools.js` | `npm test` | Run all tests |
| `node verify-installation.js` | `npm run test:verify` | Verify installation |
| Multiple test files | `npm test` | Single unified runner |
| `npm run build` | `npm run build:cross-platform` | Smart build with validation |

### üöÄ Simplified Workflow

#### Development (Claude Code in WSL2):
```bash
# 1. Edit in Claude Code (WSL2 is fine)
cd "/mnt/d/MY PROJECTS/.../RoughCut"
# Edit files normally

# 2. Smart build (handles path conversion)
npm run build:cross-platform
# Will FAIL in WSL2 (by design) - forces Windows build

# 3. Test everything
npm test
```

#### Building (Windows PowerShell):
```powershell
# Must build in Windows to avoid WSL paths
cd "D:\MY PROJECTS\...\RoughCut"
.\build-windows.ps1
# OR
npm run build
```

### üõ°Ô∏è Path Safety Features

The new system **automatically prevents** WSL path contamination:

1. **Build Protection**: `check-platform.js` blocks WSL builds
2. **Path Conversion**: `paths.ts` handles WSL ‚Üî Windows conversion
3. **Validation**: Build script checks for `/mnt/` paths
4. **Testing**: Test runner verifies no WSL paths in output

### üìä Refactoring Impact

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| Test Files | 17+ scattered | 1 unified | **94% reduction** |
| Scripts with Paths | 28 hardcoded | 0 hardcoded | **100% elimination** |
| Maintenance Effort | High | Low | **80% easier** |
| WSL Path Issues | Frequent | Never | **100% resolved** |
| Test Commands | Many confusing | 1 simple | **Much clearer** |

### üîÑ Migration Notes

#### For Existing Users:
- Old test commands still work via `npm run test:legacy`
- All functionality preserved, just reorganized
- No breaking changes to MCP tools

#### Key Changes to Know:
1. **Always build on Windows** - WSL2 builds are blocked
2. **Use `npm test`** instead of individual test files
3. **Path utilities available** via `src/config/paths.ts`
4. **Clean verification** via `npm run test:verify`

### ‚ö†Ô∏è Important Reminders

- **NEVER build in WSL2** - Always use Windows PowerShell/CMD
- **Development in WSL2 is fine** - Just don't build there
- **Use new commands** - They have built-in safety checks
- **Check ARCHITECTURE.md** - Complete guide to new structure

---